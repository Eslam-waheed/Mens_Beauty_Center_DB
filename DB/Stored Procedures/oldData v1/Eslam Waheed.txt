-- *** 1
create procedure EmployeeReport
(
    @EmployeeID int,
    @StartDate date,
    @EndDate date
)
as
begin
    select (E.FirstName + ' ' + E.LastName) as EmployeeName, count(SR.CustomerID) as CustomerCount
    from Serve SR inner join Employee E
	on SR.NationalID = E.NationalID
    where SR.NationalID = @EmployeeID and SR.Servedate between @StartDate and @EndDate
    group by E.FirstName, E.LastName;
end

-- *** 2.1
create procedure GetCustomerByPhoneNumber
(
    @PhoneNumber varchar(11)
)
as
	begin
		select Code, [Name], PhoneNumber
		from Customer
		where PhoneNumber = @PhoneNumber;
	end

-- ***2.2
create procedure GetCustomerServicesByPhoneNumber
(
    @PhoneNumber varchar(11)
)
as
	begin
		select s.ServiceName, s.Price, se.Servedate
		from Service s inner join serve se 
		on s.ID = se.ServiceId
		inner join Customer c 
		on se.CustomerId = c.Code
		where c.PhoneNumber = @PhoneNumber;
	end


-- ***2.3
create procedure GetCustomerPackagesByPhoneNumber
(
    @PhoneNumber varchar(11)
)
as
	begin
		select p.Name as PackageName, p.Description, p.TotalAmount, pc.TakeDate
		from Package p inner join PackageCustomer pc 
		on p.ID = pc.PackageId
		inner join Customer c 
		on pc.CustomerId = c.Code
		where c.PhoneNumber = @PhoneNumber;
	end
